# üì¶ Delivery Tracker ‚Äî –°–µ—Ä–≤–∏—Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Å—ã–ª–æ–∫

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Å—ã–ª–æ–∫ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–æ–π –∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º. 

**–û–∑–Ω–∞–∫–æ–º–∏—Ç—Å—è —Å–æ –≤—Å–µ–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –º–æ–∂–Ω–æ –ø–æ —Å—Å—ã–ª–∫–µ:**
–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: http://51.250.87.95:5173/docs
–¢–ì —á–∞—Ç —Å –∞–ª–µ—Ä—Ç–∞–º–∏: https://t.me/+_9c_nYyYm1RlOWNi

*–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–æ –≤–æ—Ç –≤—Å–µ —Å—Å—ã–ª–∫–∏:*
http://51.250.87.95:5173/tracker - –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–µ—Ä–≤–∏—Å–∞
http://51.250.87.95:8000/docs - –ë—ç–∫–µ–Ω–¥ —Å–µ—Ä–≤–∏—Å–∞ 
http://51.250.87.95:3000/ - Grafana
http://51.250.87.95:9090/query - Prometheus
http://51.250.87.95:8089/ - Locust
http://51.250.87.95:8765/monitoring/ - YDB
http://51.250.87.95:16686/search - Jaeger

----
## üß± –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç    | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è                     |
| ------------ | -------------------------------- |
| Backend      | Python + FastAPI + OpenTelemetry |
| Frontend     | Express Node.js                  |
| –ë–î           | YDB (Yandex Database)            |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥   | Prometheus + Grafana             |
| –¢—Ä–µ–π—Å–∏–Ω–≥     | Jaeger                           |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | Locust                           |
| IAC          | docker-compose + JSON –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤ Grafana |

-----
## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

### –í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

**Python** –±—ã–ª –≤—ã–±—Ä–∞–Ω –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –Ø–ü –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–∏—á–∏–Ω–∞–º:
- –Ø –µ–≥–æ —Ö–æ—Ä–æ—à–æ –∑–Ω–∞—é, –ø–æ—ç—Ç–æ–º—É –º–æ–≥—É –±—ã—Å—Ç—Ä–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–¥.
- –ë–æ–ª—å—à–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.

**YDB** (Yandex Database) –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–∞—è –°–£–ë–î –±–ª–∞–≥–æ–¥–∞—Ä—è:
- –í—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã
- –£–¥–æ–±–Ω–æ–º—É GUI –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –¢–∞–∫–∂–µ —Ö–æ—Ç–µ–ª –ø–æ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –±—É–¥—É—â–µ–µ, —Ç–∞–∫ –∫–∞–∫ –µ—Å—Ç—å –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±–ª–∞–∫–æ–º. 

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è YDB –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–¥–æ—á–µ—Ç—ã. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ [—Ä–∞–∑–¥–µ–ª–µ –ø—Ä–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](https://ydb.tech/docs/ru/devops/observability/monitoring) —É–∫–∞–∑–∞–Ω –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ—Ä—Ç `:31002`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –≤—Å—è –Ω—É–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞ –ø–æ—Ä—Ç—É `:8765`. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –ø–æ–ª–µ–∑–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
### Backend
–ë—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–æ—Å—Ç–æ–π –ø–æ—Å—Ç-–≥–µ—Ç —Å–µ—Ä–≤–∏—Å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä—É—á–∫–∞–º–∏:
- `/get?tracking_number=002O7N4K` - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å—ã–ª–∫–µ –ø–æ —Ç—Ä–µ–∫ –Ω–æ–º–µ—Ä—É
- `/add_package` - –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å—ã–ª–∫–µ –≤ –ë–î
- `/tracking_numbers` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–æ–≤
–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–¥–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ GUI.
### –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –±—ã–ª –Ω–∞–ø–∏—Å–∞–Ω —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ —Ä–∞–Ω–Ω–∏—Ö –∫–æ–º–º–∏—Ç–∞—Ö), –Ω–æ –≤–ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ –±—ã–ª –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ **Locust** –ø–æ –ø—Ä–∏—á–∏–Ω–∞–º:
- –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- –£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –ì–∏–±–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è `500 RPS`

### –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
–ì–æ—Ç–æ–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `/alerts-n-graphs`. –ë—ã–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ä–µ—à–µ–Ω–∏—è:
#### –î–∞—à–±–æ—Ä–¥—ã YDB
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –≥–æ—Ç–æ–≤—ã–µ [—à–∞–±–ª–æ–Ω—ã –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è](https://github.com/ydb-platform/ydb/tree/main/ydb/deploy/grafana_dashboards/), –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
- `DB overview` - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤:
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
  - –†–∞–∑–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
  - –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `DB status` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î:
  - –ó–∞–≥—Ä—É–∑–∫–∞ CPU
  - –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  - –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤

#### –î–∞—à–±–æ—Ä–¥—ã –±–µ–∫–µ–Ω–¥–∞
–ë—ã–ª –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –≥–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω:
- `Backend o11y` - –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∞—à–±–æ—Ä–¥:
  - RPS (–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É)
  - –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–æ–≤ (2xx, 5xx)
  - –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU
  - –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

### –°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞

–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–ª–µ—Ä—Ç—ã –≤ Telegram-–∫–∞–Ω–∞–ª –ø–æ –∫–ª—é—á–µ–≤—ã–º –º–µ—Ç—Ä–∏–∫–∞–º:
1. **RPS –∫ –ë–î > 100**
2. **P99 > 500 –º—Å**

*–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:* –î–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ RPS –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–µ–∫–µ–Ω–¥—É, –∞ –Ω–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ YDB, —Ç–∞–∫ –∫–∞–∫ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π RPS –∏–∑ –º–µ—Ç—Ä–∏–∫ –ë–î –æ–∫–∞–∑–∞–ª–æ—Å—å —Å–ª–æ–∂–Ω–æ–π –∑–∞–¥–∞—á–µ–π. –ù–µ—Ç –ø—Ä–æ—Å—Ç–æ —á–µ—Ç–∫–æ–≥–æ —á–∏—Å–ª–∞ RPS –∏ –∑–∞–ø—Ä–æ—Å—ã –∫ –º–µ—Ç—Ä–∏–∫–∞–º –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ –ø–∏—à—É—Ç—Å—è, –∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –º–∞–ª–æ —á—Ç–æ –µ—Å—Ç—å.

### –¢—Ä–µ–π—Å–∏–Ω–≥ —Å Jaeger
–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø—ã—Ç–∞–ª—Å—è —Å–¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ `jaeger-client`, –Ω–æ –æ–Ω –æ–∫–∞–∑–∞–ª—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º. 
–†–µ–∞–ª–∏–∑–æ–≤–∞–ª —Å –ø–æ–º–æ—â—å—é **OpenTelemetry**, —á—Ç–æ –¥–∞–µ—Ç:
- –ü–æ–ª–Ω—É—é –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ –∫–æ–¥–∞
- –í—ã—è–≤–ª–µ–Ω–∏–µ —É–∑–∫–∏—Ö –º–µ—Å—Ç –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

##### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/or0kalame/o11y-practise
cd o11ly-practise 
```

##### 2. –ü–æ–¥–Ω–∏–º–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ Docker-Compose –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ë–î:
```shell
sudo docker compose up --build
```

–î–∞–ª–ª–µ–µ –∑–∞—Ö–æ–¥–∏–º –≤ GUI YDB, –Ω–∞ –ø–æ—Ä—Ç—É `:8765` --> –ò—â–µ–º `/local`--> –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É `packages` 
```SQL
CREATE TABLE packages (
    tracking_number Utf8,
    status Utf8,
    warehouse_number Utf8,
    product_name Utf8,
    PRIMARY KEY (tracking_number)
);
```

-------------------------
### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—à–∏–±–∫–∏ **p99 > 500ms**
–ß—Ç–æ–±—ã —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, –Ω—É–∂–Ω–æ –≤ `o11y-practise/backend/app/routes.py` —Ä–∞—Å–∫–æ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å **—Å—Ç—Ä–æ–∫—É 23** —Å `time.sleep`. –û–Ω–∞ –±—É–¥–µ—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å, –ø–æ—ç—Ç–æ–º—É –±—É–¥–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è –æ—Ç–≤–µ—Ç –∏ –≤–æ–∑–Ω–∏–∫–∞—Ç—å –æ—à–∏–±–∫–∞ p99 > 500–º—Å. –ù–æ –µ—Å—Ç—å –µ—â–µ —Å–ø–æ—Å–æ–±, –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –Ω–∞ —Ä—É—á–∫—É `/tracking_numbers` –º—ã —Ç–æ–∂–µ –ø–æ–ª—É—á–∞–µ–º —ç—Ç—É –æ—à–∏–±–∫—É —Ç.–∫ —Ç—Ä–µ–∫–µ—Ä–æ–≤ –º–Ω–æ–≥–æ, –∞ –∑–∞–ø—Ä–æ—Å –æ—Ç–¥–∞–µ—Ç—Å—è –æ—á–µ–Ω—å –¥–æ–ª–≥–æ(–∏–Ω–¥–µ–∫—Å —è –Ω–µ –¥–µ–ª–∞–ª). –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å, —Ç–æ —è –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º–µ **@martin_gati**. –ù–æ —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –≤—Å–µ –ø–æ–¥–Ω—è—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ. 
